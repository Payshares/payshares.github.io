<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!--

  Want to contribute to this site? Take a look at the GitHub repository for this
  site: https://github.com/payshares/developers

  -->
  <title>Federation | Payshares Developers</title>
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->
  <meta name="author" content="Payshares.org and contributors">

  <meta property="og:title" content="Federation | Payshares Developers">
  <meta property="og:type" content="website">


  <link rel="stylesheet" href="/styles/index-642cd6cc68250700f4daa5029026a066.css">

  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicon/rocket-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicon/rocket-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/rocket-180x180.png">
  <link rel="icon" type="image/png" href="/images/favicon/rocket-96x96.png" sizes="96x96">
  <meta name="msapplication-TileImage" content="/images/favicon/rocket-144x144.png">

  <script type="text/javascript">
    var $mcGoal = {'settings':{'uuid':'c001d97369b7a10d224c23867','dc':'us9'}};
    (function() {
      var sp = document.createElement('script'); sp.type = 'text/javascript'; sp.async = true; sp.defer = true;
      sp.src = ('https:' == document.location.protocol ? 'https://s3.amazonaws.com/downloads.mailchimp.com' : 'http://downloads.mailchimp.com') + '/js/goal.min.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(sp, s);
    })();
  </script>

  <script>window.clientData = {};</script>

  <script type="text/javascript">
  setTimeout(function(){var a=document.createElement("script");
  var b=document.getElementsByTagName("script")[0];
  a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
  </script>
</head>
<body>
<div class="header2016">
  <div class="header2016__logo header2016__logo--spaced">
    <div class="so-siteHeader">
      <span class="so-logo">
  <a href="https://www.payshares.org/" class="so-logo__main">Payshares</a><!--
  --><span class="so-logo__separator"> </span><!--
  --><a href="/" class="so-logo__subSite">developers</a>
</span>
    </div>
  </div>
  <nav class="header2016__nav mainNavMenu spu-padStart-30">
    <a class="mainNavMenu__item is-currentItem" href="/guides/">Guides</a>
<a class="mainNavMenu__item " href="/reference/">API Reference</a>
<a class="mainNavMenu__item " href="/software/">Software</a>
<a class="mainNavMenu__item " href="/tools/">Tools</a>
  </nav>
</div>

<div class="S-flex-row">
  <div class="siteSidebar pageNavListBounder">
  <div class="mainSidebar">
    <ul class="pageNavList">

      <li class="pageNavList__subList">
        <span class="pageNavList__title">Get Started</span>
        <ol class="collapsibleListSet__list">
                    <li class="pageNavList__item"><a href="/guides/get-started/index.html">Payshares Network Overview</a></li>
          <li class="pageNavList__item"><a href="/guides/get-started/create-account.html">Create an Account</a></li>
  <li class="pageNavList__item"><a href="/guides/get-started/transactions.html">Send and Receive Money</a></li>

        </ol>
      </li>
    


      <li class="pageNavList__subList">
        <span class="pageNavList__title">Become an Anchor</span>
        <ol class="collapsibleListSet__list">
                    <li class="pageNavList__item"><a href="/guides/anchor/index.html">Architecture</a></li>
          <li class="pageNavList__item"><a href="/guides/anchor/2-bridge-server.html">Bridge Server</a></li>
  <li class="pageNavList__item"><a href="/guides/anchor/3-federation-server.html">Federation Server</a></li>
  <li class="pageNavList__item"><a href="/guides/anchor/4-compliance-server.html">Compliance Server</a></li>
  <li class="pageNavList__item"><a href="/guides/anchor/5-conclusion.html">Next Steps</a></li>

        </ol>
      </li>
    
      
      <li class="pageNavList__subList">
        <span class="pageNavList__title">Concepts</span>
        <ul class="collapsibleListSet__list">
              <li class="pageNavList__item"><a href="/guides/concepts/accounts.html">Accounts</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/assets.html">Assets</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/exchange.html">Distributed Exchange</a></li>
  <li class="pageNavList__item is-currentItem"><a href="/guides/concepts/federation.html">Federation</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/fees.html">Fees</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/inflation.html">Inflation</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/ledger.html">Ledger</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/list-of-operations.html">List of Operations</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/multi-sig.html">Multisignature</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/operations.html">Operations</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/scp.html">Payshares Consensus Protocol</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/stellar-toml.html">Payshares.toml</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/test-net.html">Testnet</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/transactions.html">Transactions</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/versioning.html">Versioning and Upgrading</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/xdr.html">XDR</a></li>

        </ul>
      </li>
    
        <li class="pageNavList__item"><a href="/guides/attachment.html">Payshares Attachment Convention</a></li>
  <li class="pageNavList__item"><a href="/guides/channels.html">Channels</a></li>
  <li class="pageNavList__item"><a href="/guides/compliance-protocol.html">Compliance Protocol</a></li>
  <li class="pageNavList__item"><a href="/guides/issuing-assets.html">Issuing Assets</a></li>
  <li class="pageNavList__item"><a href="/guides/security.html">Security</a></li>
  <li class="pageNavList__item"><a href="/guides/things-to-build.html">Build Payshares Apps</a></li>
        <li class="pageNavList__item"><a href="/guides/contributing.html">Contribution Guide</a></li>
    </ul>
  </div>
</div>
  <div class="S-flexItem-share">
  <div class="spu-padSE-30">
    <h1 class="mainSectionTitle">
      Federation
      
    </h1>
  </div>
  <div class="S-flex-rowWrap spu-borderTop-1 spu-borderColor-neutral7">
    <s-read-md class="S-flexItem-share mainContent s-read-md--capped spu-padSE-30 spu-padTB-20 documentRead" link-process-md>
      <p>The Payshares federation protocol maps Payshares addresses to more information about a given user. It&#x2019;s a way for Payshares client software
to resolve email-like addresses such as <code>name*yourdomain.com</code> into account IDs like: <code>GCCVPYFOHY7ZB7557JKENAX62LUAPLMGIWNZJAFV2MITK6T32V37KEJU</code>. Payshares addresses provide
an easy way for users to share payment details by using a syntax that interoperates across different domains and providers.</p>
<figure><img src="assets/mockup.png" alt="Mockup of using a payment address"></figure>
<h2 id="payshares-addresses"><a class="anchorShortcut" href="#payshares-addresses" aria-hidden="true"></a> Payshares addresses</h2>
<p>Payshares addresses are divided into two parts separated by <code>*</code>, the username and the domain.</p>
<p>For example:  <code>jed*payshares.org</code>:</p>
<ul>
<li><code>jed</code> is the username,</li>
<li><code>payshares.org</code> is the domain.</li>
</ul>
<p>The domain can be any valid RFC 1035 domain name.
The username is limited to printable UTF-8 with whitespace and the following characters excluded: &lt;*,&gt; Although of course the domain administrator can place additional restrictions on usernames of its domain.</p>
<p>Note that the <code>@</code> symbol is allowed in the username. This allows for using email addresses in the username of an address. For example: <code>maria@gmail.com*payshares.org</code>.</p>
<h2 id="supporting-federation"><a class="anchorShortcut" href="#supporting-federation" aria-hidden="true"></a> Supporting Federation</h2>
<h3 id="step-1-create-a-paysharestoml-file"><a class="anchorShortcut" href="#step-1-create-a-paysharestoml-file" aria-hidden="true"></a> Step 1: Create a <a href="./payshares-toml.html">payshares.toml</a> file</h3>
<p>Create a file called payshares.toml and put it at <code>https://YOUR_DOMAIN/.well-known/payshares.toml</code>.</p>
<h3 id="step-2-add-federation-url"><a class="anchorShortcut" href="#step-2-add-federation-url" aria-hidden="true"></a> Step 2: Add federation_url</h3>
<p>Add a <code>FEDERATION_SERVER</code> section to your payshares.toml file that tells other people the URL of your federation endpoint.</p>
<p>For example: <code>FEDERATION_SERVER=&quot;https://api.yourdomain.com/federation&quot;</code></p>
<p>Please note that your federation server <strong>must</strong> use <code>https</code> protocol.</p>
<h3 id="step-3-implement-federation-url-http-endpoint"><a class="anchorShortcut" href="#step-3-implement-federation-url-http-endpoint" aria-hidden="true"></a> Step 3: Implement federation url HTTP endpoint</h3>
<p>The federation URL specified in your payshares.toml file should accept an HTTP GET request and issue responses of the form detailed below.</p>
<p>Instead of building your own server you can use the <a href="https://github.com/payshares/go/tree/master/services/federation"><code>federation server</code></a> built by Payshares Development Foundation.</p>
<h2 id="federation-requests"><a class="anchorShortcut" href="#federation-requests" aria-hidden="true"></a> Federation Requests</h2>
<p>You can use the federation endpoint to look up an account id if you have a payshares address. You can also do reverse federation and look up a payshares addresses from account ids or transaction ids. This is useful to see who has sent you a payment.</p>
<p>Federation requests are http <code>GET</code> requests with the following form:</p>
<p><code>?q=&lt;string to look up&gt;&amp;type=&lt;name,id,txid&gt;</code></p>
<p>Supported types:</p>
<ul>
<li><strong>name</strong>: Example: <code>https://YOUR_FEDERATION_SERVER/federation?q=jed*payshares.org&amp;type=name</code></li>
<li><strong>forward</strong>: Used for forwarding the payment on to a different network or different financial institution. The other parameters of the query will vary depending on what kind of institution is the ultimate destination of the payment and what you as the forwarding anchor supports. Your <a href="./payshares-toml.html">payshares.toml</a> file should specify what parameters you expect in a <code>forward</code> federation request. If you are unable to forward or the other parameters in the request are incorrect you should return an error to this effect. Example request:   <code>https://YOUR_FEDERATION_SERVER/federation?type=forward&amp;forward_type=bank_account&amp;swift=BOPBPHMM&amp;acct=2382376</code></li>
<li><strong>id</strong>: <em>not supported by all federation servers</em> Reverse federation will return the federation record of the Payshares address associated with the given account ID. In some cases this is ambiguous. For instance if an anchor sends transactions on behalf of its users the account id will be of the anchor and the federation server won&#x2019;t be able to resolve the particular user that sent the transaction. In cases like that you may need to use <strong>txid</strong> instead. Example: <code>https://YOUR_FEDERATION_SERVER/federation?q=GD6WU64OEP5C4LRBH6NK3MHYIA2ADN6K6II6EXPNVUR3ERBXT4AN4ACD&amp;type=id</code></li>
<li><strong>txid</strong>: <em>not supported by all federation servers</em> Will return the federation record of the sender of the transaction if known by the server. Example: <code>https://YOUR_FEDERATION_SERVER/federation?q=c1b368c00e9852351361e07cc58c54277e7a6366580044ab152b8db9cd8ec52a &amp;type=txid</code></li>
</ul>
<h3 id="federation-response"><a class="anchorShortcut" href="#federation-response" aria-hidden="true"></a> Federation Response</h3>
<p>The federation server should respond with an appropriate HTTP status code, headers and a JSON response.</p>
<p>You must enable CORS on the federation server so clients can send requests from other sites. The following HTTP header must be set for all federation server responses.</p>
<pre><code>Access-Control-Allow-Origin: *
</code></pre>
<p>When a record has been found the response should return <code>200 OK</code> http status code and the following JSON body:</p>
<pre><code>{
  &quot;payshares_address&quot;: &lt;username*domain.tld&gt;,
  &quot;account_id&quot;: &lt;account_id&gt;,
  &quot;memo_type&quot;: &lt;&quot;text&quot;, &quot;id&quot; , or &quot;hash&quot;&gt; *optional*
  &quot;memo&quot;: &lt;memo to attach to any payment. if &quot;hash&quot; type then will be base64 encoded&gt; *optional*
}
</code></pre>
<p>If a redirect is needed the federation server should return <code>3xx</code> http status code and immediately redirect the user to the correct URL using the <code>Location</code> header.</p>
<p>When a record has not been found <code>404 Not Found</code> http status code should be returned.</p>
<p>Every other http status code will be considered an error. The body should contain error details:</p>
<pre><code>{
   &quot;detail&quot;: &quot;extra details provided by the federation server&quot;
}
</code></pre>
<h2 id="looking-up-federation-provider-via-a-home-domain-entry"><a class="anchorShortcut" href="#looking-up-federation-provider-via-a-home-domain-entry" aria-hidden="true"></a> Looking up federation provider via a home domain entry</h2>
<p>Accounts may optionally have a <a href="./accounts.html#home-domain">home domain</a> specified. This allows an account to programmatically specify where is the main federation provider for that account.</p>
<h2 id="caching"><a class="anchorShortcut" href="#caching" aria-hidden="true"></a> Caching</h2>
<p>You shouldn&#x2019;t cache responses from federation servers. Some organizations may generate random IDs to protect their users&#x2019; privacy. Those IDs may change over time.</p>

      <br>
      <a href="https://github.com/payshares/docs/blob/master/guides/concepts/federation.md" class="spu-color-neutral6">Edit this doc in GitHub</a>
    </s-read-md>
  
  </div>
</div>
</div>

<div class="so-back spu-borderTop-1 spu-borderColor-neutral7 spu-padTB-15">
  <div class="so-chunk">
    <div class="siteFooter">
      <div class="siteFooter__list">
        <a class="siteFooter__list__item" href="https://www.payshares.org/"><span class="graphic-backArrow-9"></span>&#xA0;&#xA0;Payshares.org</a>
        <span class="siteFooter__list__sep">|</span>
        <a class="siteFooter__list__item" href="https://www.payshares.org/bug-bounty-program/">Bug Bounty</a>
        <a class="siteFooter__list__item" href="/payshares-core/software/admin.html">Run a node</a>
        <a class="siteFooter__list__item" href="/guides/things-to-build.html">Build an app</a>
        <a class="siteFooter__list__item" href="https://github.com/payshares/">GitHub</a>
        <a class="siteFooter__list__item" href="http://slack.payshares.org/">Community chat</a>
      </div>
      <div class="siteFooter__list siteFooter__list--aux">
        <a class="siteFooter__list__item siteFooter__list__item--aux" href="https://www.payshares.org/terms-of-service/">Terms of service</a>
        <a class="siteFooter__list__item siteFooter__list__item--aux" href="https://www.payshares.org/privacy-policy/">Privacy policy</a>
      </div>
    </div>
  </div>
</div>
</body>
<script src="/js/app-29e9eab4c89c33d7fb1e0705ca62d0cc.js"></script>
<script type="text/javascript">
!function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
analytics.load("U8cLXTFMPm");
analytics.page()
}}();
</script>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5V3WNNP');</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5V3WNNP" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
</html>
