<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!--

  Want to contribute to this site? Take a look at the GitHub repository for this
  site: https://github.com/payshares/developers

  -->
  <title>Administration - Horizon | Payshares Developers</title>
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->
  <meta name="author" content="Payshares.org and contributors">

  <meta property="og:title" content="Administration - Horizon | Payshares Developers">
  <meta property="og:type" content="website">


  <link rel="stylesheet" href="/styles/index-642cd6cc68250700f4daa5029026a066.css">

  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicon/rocket-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicon/rocket-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/rocket-180x180.png">
  <link rel="icon" type="image/png" href="/images/favicon/rocket-96x96.png" sizes="96x96">
  <meta name="msapplication-TileImage" content="/images/favicon/rocket-144x144.png">

  <script type="text/javascript">
    var $mcGoal = {'settings':{'uuid':'c001d97369b7a10d224c23867','dc':'us9'}};
    (function() {
      var sp = document.createElement('script'); sp.type = 'text/javascript'; sp.async = true; sp.defer = true;
      sp.src = ('https:' == document.location.protocol ? 'https://s3.amazonaws.com/downloads.mailchimp.com' : 'http://downloads.mailchimp.com') + '/js/goal.min.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(sp, s);
    })();
  </script>

  <script>window.clientData = {};</script>

  <script type="text/javascript">
  setTimeout(function(){var a=document.createElement("script");
  var b=document.getElementsByTagName("script")[0];
  a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
  </script>
</head>
<body>
<div class="header2016">
  <div class="header2016__logo header2016__logo--spaced">
    <div class="so-siteHeader">
      <span class="so-logo">
  <a href="https://www.payshares.org/" class="so-logo__main">Payshares</a><!--
  --><span class="so-logo__separator"> </span><!--
  --><a href="/" class="so-logo__subSite">developers</a>
</span>
    </div>
  </div>
  <nav class="header2016__nav mainNavMenu spu-padStart-30">
    <a class="mainNavMenu__item " href="/guides/">Guides</a>
<a class="mainNavMenu__item is-currentItem" href="/reference/">API Reference</a>
<a class="mainNavMenu__item " href="/software/">Software</a>
<a class="mainNavMenu__item " href="/tools/">Tools</a>
  </nav>
</div>

<div class="S-flex-row">
  <div class="siteSidebar pageNavListBounder">
  <div class="mainSidebar">
    <ul class="pageNavList">


      <li class="pageNavList__subList collapsibleListSet js-collapsibleListSet">
        <span class="pageNavList__title collapsibleListSet__label js-collapsibleListSet__label">REST API</span>
        <ul class="collapsibleListSet__list js-collapsibleListSet__list is-collapsed">
                    <li class="pageNavList__item"><a href="/horizon/reference/index.html">Overview</a></li>
          <li class="pageNavList__item is-currentItem"><a href="/horizon/reference/admin.html">Administration</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/errors.html">Errors</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/paging.html">Paging</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/rate-limiting.html">Rate Limiting</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/responses.html">Response Format</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/xdr.html">XDR</a></li>
        
      <li class="pageNavList__subList">
        <span class="pageNavList__title">Tutorials</span>
        <ul class="collapsibleListSet__list">
              <li class="pageNavList__item"><a href="/horizon/reference/tutorials/follow-received-payments.html">Follow Received Payments</a></li>

        </ul>
      </li>
            
      <li class="pageNavList__subList">
        <span class="pageNavList__title">Endpoints</span>
        <ul class="collapsibleListSet__list">
              <li class="pageNavList__item"><a href="/horizon/reference/endpoints/accounts-single.html">Account Details</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/data-for-account.html">Data for Account</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/effects-all.html">All Effects</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/effects-for-account.html">Effects for Account</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/effects-for-ledger.html">Effects for Ledger</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/effects-for-operation.html">Effects for Operation</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/effects-for-transaction.html">Effects for Transaction</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/ledgers-all.html">All Ledgers</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/ledgers-single.html">Ledger Details</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/offers-for-account.html">Offers for Account</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/operations-all.html">All Operations</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/operations-for-account.html">Operations for Account</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/operations-for-ledger.html">Operations for Ledger</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/operations-for-transaction.html">Operations for Transaction</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/operations-single.html">Operation Details</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/orderbook-details.html">Orderbook Details</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/path-finding.html">Find Payment Paths</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/payments-all.html">All Payments</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/payments-for-account.html">Payments for Account</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/payments-for-ledger.html">Payments for Ledger</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/payments-for-transaction.html">Payments for Transaction</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/trades-for-orderbook.html">Trades for Orderbook</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/transactions-all.html">All Transactions</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/transactions-create.html">Post Transaction</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/transactions-for-account.html">Transactions for Account</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/transactions-for-ledger.html">Transactions for Ledger</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/endpoints/transactions-single.html">Transaction Details</a></li>

        </ul>
      </li>
            
      <li class="pageNavList__subList">
        <span class="pageNavList__title">Resources</span>
        <ul class="collapsibleListSet__list">
              <li class="pageNavList__item"><a href="/horizon/reference/resources/account.html">Account</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/resources/data.html">Data</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/resources/effect.html">Effect</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/resources/ledger.html">Ledger</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/resources/offer.html">Offer</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/resources/operation.html">Operation</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/resources/orderbook.html">Orderbook</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/resources/page.html">Page</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/resources/path.html">Payment Path</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/resources/trade.html">Trade</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/resources/transaction.html">Transaction</a></li>

        </ul>
      </li>
            
      <li class="pageNavList__subList">
        <span class="pageNavList__title">Errors</span>
        <ul class="collapsibleListSet__list">
              <li class="pageNavList__item"><a href="/horizon/reference/errors/bad-request.html">Bad Request</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/errors/before-history.html">Before History</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/errors/forbidden.html">Forbidden</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/errors/not-acceptable.html">Not Acceptable</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/errors/not-found.html">Not Found</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/errors/not-implemented.html">Not Implemented</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/errors/rate-limit-exceeded.html">Rate Limit Exceeded</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/errors/server-error.html">Internal Server Error</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/errors/stale-history.html">Stale History</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/errors/transaction-failed.html">Transaction Failed</a></li>
  <li class="pageNavList__item"><a href="/horizon/reference/errors/transaction-malformed.html">Transaction Malformed</a></li>

        </ul>
      </li>
    
        </ul>
      </li>
    

      <li class="pageNavList__subList collapsibleListSet js-collapsibleListSet">
        <span class="pageNavList__title collapsibleListSet__label js-collapsibleListSet__label">JavaScript SDK</span>
        <ul class="collapsibleListSet__list js-collapsibleListSet__list is-collapsed">
                    <li class="pageNavList__item"><a href="/js-payshares-sdk/reference/index.html">Overview</a></li>
          <li class="pageNavList__item"><a href="/js-payshares-base/reference/base-examples.html">Transaction Examples</a></li>
  <li class="pageNavList__item"><a href="/js-payshares-base/reference/building-transactions.html">Building Transactions</a></li>
          <li class="pageNavList__item"><a href="/js-payshares-sdk/reference/examples.html">Basic Examples</a></li>
        <li class="pageNavList__item"><a href="https://payshares.github.io/js-payshares-sdk/" target="_blank" rel="noopener noreferrer">API Reference <span class="icon-faSvg icon-faSvg--small icon-faSvg-external-neutral5"></span></a></li>

        </ul>
      </li>
    

      <li class="pageNavList__subList collapsibleListSet js-collapsibleListSet">
        <span class="pageNavList__title collapsibleListSet__label js-collapsibleListSet__label">Go SDK</span>
        <ul class="collapsibleListSet__list js-collapsibleListSet__list is-collapsed">
                                  <li class="pageNavList__item"><a href="https://godoc.org/github.com/payshares/go" target="_blank">Godoc <span class="icon-faSvg icon-faSvg--small icon-faSvg-external-neutral5"></span></a></li>

        </ul>
      </li>
    

      <li class="pageNavList__item"><a href="https://github.com/payshares/java-payshares-sdk" target="_blank" rel="noopener noreferrer">Java SDK <span class="icon-faSvg icon-faSvg--small icon-faSvg-external-neutral5"></span></a></li>
      <li class="pageNavList__item"><a href="https://github.com/payshares/ruby-payshares-sdk" target="_blank" rel="noopener noreferrer">Ruby SDK <span class="icon-faSvg icon-faSvg--small icon-faSvg-external-neutral5"></span></a></li>
      <li class="pageNavList__item"><a href="https://github.com/PaysharesCN/py-payshares-base" target="_blank" rel="noopener noreferrer">Python SDK <span class="icon-faSvg icon-faSvg--small icon-faSvg-external-neutral5"></span></a></li>
      <li class="pageNavList__item"><a href="https://github.com/QuantozTechnology/csharp-payshares-base" target="_blank" rel="noopener noreferrer">C# SDK <span class="icon-faSvg icon-faSvg--small icon-faSvg-external-neutral5"></span></a></li>

    </ul>
  </div>
</div>
  <div class="S-flexItem-share">
  <div class="spu-padSE-30">
    <h1 class="mainSectionTitle">
      Administration
      &#xA0;<span class="spu-color-neutral6">[Horizon]</span>
    </h1>
  </div>
  <div class="S-flex-rowWrap spu-borderTop-1 spu-borderColor-neutral7">
    <s-read-md class="S-flexItem-share mainContent s-read-md--capped spu-padSE-30 spu-padTB-20 documentRead" link-process-md>
      <p>Horizon is responsible for providing an HTTP API to data in the Payshares network. It ingests and re-serves the data produced by the payshares network in a form that is easier to consume than the performance-oriented data representations used by payshares-core.</p>
<h2 id="why-run-horizon"><a class="anchorShortcut" href="#why-run-horizon" aria-hidden="true"></a> Why run horizon?</h2>
<p>The payshares development foundation runs two horizon servers, one for the public network and one for the test network, free for anyone&#x2019;s use at <a href="https://horizon.payshares.org">https://horizon.payshares.org</a> and <a href="https://horizon-testnet.payshares.org">https://horizon-testnet.payshares.org</a>.  These servers should be fine for development and small scale projects, but is not recommended that you use them for production services that need strong reliability.  By running horizon within your own infrastructure provides a number of benefits:</p>
<ul>
<li>Multiple instances can be run for redundancy and scalability.</li>
<li>Request rate limiting can be disabled.</li>
<li>Full operational control without dependency on the Payshares Developers operations.</li>
</ul>
<h2 id="prerequisites"><a class="anchorShortcut" href="#prerequisites" aria-hidden="true"></a> Prerequisites</h2>
<p>Horizon is a dependent upon a payshares-core server.  Horizon needs access to both the SQL database and the HTTP API that is published by payshares-core. See <a href="/payshares-core/learn/admin.html">the administration guide</a> to learn how to set up and administer a payshares-core server.  Secondly, horizon is dependent upon a postgresql server, which it uses to store processed core data for ease of use. Horizon requires postgres version &gt;= 9.3.</p>
<p>In addition to the two required prerequisites above, you may optionally install a redis server to be used for rate limiting requests.</p>
<h2 id="installing"><a class="anchorShortcut" href="#installing" aria-hidden="true"></a> Installing</h2>
<p>To install horizon, you have a choice: either downloading a <a href="https://github.com/payshares/horizon/releases">prebuilt release for your target architecture</a> and operation system, or <a href="#Building">building horizon yourself</a>.  When either approach is complete, you will find yourself with a directory containing a file named <code>horizon</code>.  This file is a native binary.</p>
<p>After building or unpacking horizon, you simply need to copy the native binary into a directory that is part of your PATH.  Most unix-like systems have <code>/usr/local/bin</code> in PATH by default, so unless you have a preference or know better, we recommend you copy the binary there.</p>
<p>To test the installation, simply run <code>horizon --help</code> from a terminal.  If the help for horizon is displayed, your installation was successful. Note: some shells, such as zsh, cache PATH lookups.  You may need to clear your cache  (by using <code>rehash</code> in zsh, for example) before trying to run <code>horizon --help</code>.</p>
<h2 id="building"><a class="anchorShortcut" href="#building" aria-hidden="true"></a> Building</h2>
<p>Should you decide not to use one of our prebuilt releases, you may instead build horizon from source.  To do so, you need to install some developer tools:</p>
<ul>
<li>A unix-like operating system with the common core commands (cp, tar, mkdir, bash, etc.)</li>
<li>A compatible distribution of go (we officially support go 1.6 and later)</li>
<li><a href="https://getgb.io/">gb</a></li>
<li><a href="https://git-scm.com/">git</a></li>
</ul>
<p>Provided your workstation satisfies the requirements above, follow the steps below:</p>
<ol>
<li>Clone horizon&#x2019;s source:  <code>git clone https://github.com/payshares/horizon.git &amp;&amp; cd horizon</code></li>
<li>Download external dependencies: <code>gb vendor restore</code></li>
<li>Build the binary: <code>gb build</code></li>
</ol>
<p>After running the above commands have succeeded, the built horizon will have be written into the <code>bin</code> subdirectory of the current directory.</p>
<p>Note:  Building directly on windows is not supported.</p>
<h2 id="configuring"><a class="anchorShortcut" href="#configuring" aria-hidden="true"></a> Configuring</h2>
<p>Horizon is configured using command line flags or environment variables.  To see the list of command line flags that are available (and their default values) for your version of horizon, run:</p>
<p><code>horizon --help</code></p>
<p>As you will see if you run the command above, horizon defines a large number of flags, however only three are required:</p>
<table>
<thead>
<tr>
<th>flag</th>
<th>envvar</th>
<th>example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--db-url</code></td>
<td><code>DATABASE_URL</code></td>
<td>postgres://localhost/horizon_testnet</td>
</tr>
<tr>
<td><code>--payshares-core-db-url</code></td>
<td><code>PAYSHARES_CORE_DATABASE_URL</code></td>
<td>postgres://localhost/core_testnet</td>
</tr>
<tr>
<td><code>--payshares-core-url</code></td>
<td><code>PAYSHARES_CORE_URL</code></td>
<td><a href="http://localhost:11757">http://localhost:11757</a></td>
</tr>
</tbody>
</table>
<p><code>--db-url</code> specifies the horizon database, and its value should be a valid <a href="http://www.postgresql.org/docs/9.2/static/libpq-connect.html#AEN38419">PostgreSQL Connection URI</a>.  <code>--payshares-core-db-url</code> specifies a payshares-core database which will be used to load data about the payshares ledger.  Finally, <code>--payshares-core-url</code> specifies the HTTP control port for an instance of payshares-core.  This URL should be associated with the payshares-core that is writing to the database at <code>--payshares-core-db-url</code>.</p>
<p>Specifying command line flags every time you invoke horizon can be cumbersome, and so we recommend using environment variables.  There are many tools you can use to manage environment variables:  we recommend either <a href="http://direnv.net/">direnv</a> or <a href="https://github.com/bkeepers/dotenv">dotenv</a>.  A template configuration that is compatible with dotenv can be found in the <a href="https://github.com/payshares/horizon/blob/master/.env.template">horizon git repo</a>.</p>
<h2 id="preparing-the-database"><a class="anchorShortcut" href="#preparing-the-database" aria-hidden="true"></a> Preparing the database</h2>
<p>Before the horizon server can be run, we must first prepare the horizon database.  This database will be used for all of the information produced by horizon, notably historical information about successful transactions that have occurred on the payshares network.</p>
<p>To prepare a database for horizon&#x2019;s use, first you must ensure the database is blank.  It&#x2019;s easiest to simply create a new database on your postgres server specifically for horizon&#x2019;s use.  Next you must install the schema by running <code>horizon db init</code>.  Remember to use the appropriate command line flags or environment variables to configure horizon as explained in <a href="#Configuring">Configuring </a>.  This command will log any errors that occur.</p>
<h2 id="running"><a class="anchorShortcut" href="#running" aria-hidden="true"></a> Running</h2>
<p>Once your horizon database is configured, you&#x2019;re ready to run horizon.  To run horizon you simply run <code>horizon</code> or <code>horizon serve</code>, both of which start the HTTP server and start logging to standard out.  When run, you should see some output that similar to:</p>
<pre><code>INFO[0000] Starting horizon on :8000                     pid=29013
</code></pre>
<p>The log line above announces that horizon is ready to serve client requests. Note: the numbers shown above may be different for your installation.  Next we can confirm that horizon is responding correctly by loading the root resource.  In the example above, that URL would be [<a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a>] and simply running <code>curl http://127.0.0.1:8000/</code> shows you that the root resource can be loaded correctly.</p>
<h2 id="ingesting-payshares-core-data"><a class="anchorShortcut" href="#ingesting-payshares-core-data" aria-hidden="true"></a> Ingesting payshares-core data</h2>
<p>Horizon provides most of its utility through ingested data.  Your horizon server can be configured to listen for and ingest transaction results from the connected payshares-core.  We recommend that within your infrastructure you run one (and only one) horizon process that is configured in this way.   While running multiple ingestion processes will not corrupt the horizon database, your error logs will quickly fill up as the two instances race to ingest the data from payshares-core.  We may develop a system that coordinates multiple horizon processes in the future, but we would also be happy to include an external contribution that accomplishes this.</p>
<p>To enable ingestion, you must either pass <code>--ingest=true</code> on the command line or set the <code>INGEST</code> environment variable to &#x201C;true&#x201D;.</p>
<h3 id="managing-storage-for-historical-data"><a class="anchorShortcut" href="#managing-storage-for-historical-data" aria-hidden="true"></a> Managing storage for historical data</h3>
<p>Given an empty horizon database, any and all available history on the attached payshares-core instance will be ingested. Over time, this recorded history will grow unbounded, increasing storage used by the database.  To keep you costs down, you may configure horizon to only retain a certain number of ledgers in the historical database.  This is done using the <code>--history-retention-count</code> flag or the <code>HISTORY_RETENTION_COUNT</code> environment variable.  Set the value to the number of recent ledgers you with to keep around, and every hour the horizon subsystem will reap expired data.  Alternatively, you may execute the command <code>horizon db reap</code> to force a collection.</p>
<h3 id="surviving-payshares-core-downtime"><a class="anchorShortcut" href="#surviving-payshares-core-downtime" aria-hidden="true"></a> Surviving payshares-core downtime</h3>
<p>Horizon tries to maintain a gap-free window into the history of the payshares-network.  This reduces the number of edge cases that horizon-dependent software must deal with, aiming to make the integration process simpler.  To maintain a gap-free history, horizon needs access to all of the metadata produced by payshares-core in the process of closing a ledger, and there are instances when this metadata can be lost.  Usually, this loss of metadata occurs because the payshares-core node went offline and performed a catchup operation when restarted.</p>
<p>To ensure that the metadata required by horizon is maintained, you have several options: You may either set the <code>CATCHUP_COMPLETE</code> payshares-core configuration option to <code>true</code> or configure <code>CATCHUP_RECENT</code> to determine the amount of time your payshares-core can be offline without having to rebuild your horizon database.</p>
<p>We <em>do not</em> recommend using the <code>CATCHUP_COMPLETE</code> method, as this will force payshares-core to apply every transaction from the beginning of the ledger, which will take an ever increasing amount of time.  Instead, we recommend you set the <code>CATCHUP_RECENT</code> config value.  To do this, determine how long of a downtime you would like to survive (expressed in seconds) and divide by ten.  This roughly equates to the number of ledgers that occur within you desired grace period (ledgers roughly close at a rate of one every ten seconds).  With this value set, payshares-core will replay transactions for ledgers that are recent enough, ensuring that the metadata needed by horizon is present.</p>
<h3 id="correcting-gaps-in-historical-data"><a class="anchorShortcut" href="#correcting-gaps-in-historical-data" aria-hidden="true"></a> Correcting gaps in historical data</h3>
<p>In the section above, we mentioned that horizon <em>tries</em> to maintain a gap-free window.  Unfortunately, it cannot directly control the state of payshares-core and so gaps may form due to extended down time.  When a gap is encountered, horizon will stop ingesting historical data and complain loudly in the log with error messages (log lines will include &#x201C;ledger gap detected&#x201D;).  To resolve this situation, you must re-establish the expected state of the payshares-core database and purge historical data from horizon&#x2019;s database.  We leave the details of this process up to the reader as it is dependent upon your operating needs and configuration, but we offer one potential solution:</p>
<p>We recommend you configure the HISTORY_RETENTION_COUNT in horizon to a value less than or equal to the configured value for CATCHUP_RECENT in payshares-core.  Given this situation any downtime that would cause a ledger gap will require a downtime greater than the amount of historical data retained by horizon.  To re-establish continuity, simply:</p>
<ol>
<li>Stop horizon.</li>
<li>run <code>horizon db reap</code> to clear the historical database.</li>
<li>Clear the cursor for horizon by running <code>payshares-core -c &quot;dropcursor?id=HORIZON&quot;</code> (ensure capitilization is maintained).</li>
<li>Clear ledger metadata from before the gap by running <code>payshares-core -c &quot;maintenance?queue=true&quot;</code>.</li>
<li>Restart horizon.</li>
</ol>
<h2 id="managing-stale-historical-data"><a class="anchorShortcut" href="#managing-stale-historical-data" aria-hidden="true"></a> Managing Stale Historical Data</h2>
<p>Horizon ingests ledger data from a connected instance of payshares-core.  In the event that payshares-core stops running (or if horizon stops ingesting data for any other reason), the view provided by horizon will start to lag behind reality.  For simpler applications, this may be fine, but in many cases this lag is unacceptable and the application should not continue operating until the lag is resolved.</p>
<p>To help applications that cannot tolerate lag, horizon provides a configurable &#x201C;staleness&#x201D; threshold.  Given that enough lag has accumulated to surpass this threshold (expressed in number of ledgers), horizon will only respond with an error: <a href="./errors/stale-history.html"><code>stale_history</code></a>.  To configure this option, use either the <code>--history-stale-threshold</code> command line flag or the <code>HISTORY_STALE_THRESHOLD</code> environment variable.  NOTE:  non-historical requests (such as submitting transactions or finding payment paths) will not error out when the staleness threshold is surpassed.</p>
<h2 id="monitoring"><a class="anchorShortcut" href="#monitoring" aria-hidden="true"></a> Monitoring</h2>
<p>To ensure that your instance of horizon is performing correctly we encourage you to monitor it, and provide both logs and metrics to do so.</p>
<p>Horizon will output logs to standard out.  Information about what requests are coming in will be reported, but more importantly and warnings or errors will also be emitted by default.  A correctly running horizon instance will not ouput any warning or error log entries.</p>
<p>Metrics are collected while a horizon process is running and they are exposed at the <code>/metrics</code> path.  You can see an example at (<a href="https://horizon-testnet.payshares.org/metrics">https://horizon-testnet.payshares.org/metrics</a>).</p>
<h2 id="im-stuck-help"><a class="anchorShortcut" href="#im-stuck-help" aria-hidden="true"></a> I&#x2019;m Stuck! Help!</h2>
<p>If any of the above steps don&#x2019;t work or you are otherwise prevented from correctly setting up horizon, please come to our community and tell us.  Either <a href="https://github.com/payshares/horizon/issues">post an issue in the horizon github repo</a> or <a href="http://slack.payshares.org/">chat with us on slack</a> to ask for help.</p>

      <br>
      <a href="https://github.com/payshares/horizon/blob/master/docs/reference/admin.md" class="spu-color-neutral6">Edit this doc in GitHub</a>
    </s-read-md>
    <s-read-md class="endpointRef-exampleBar spu-background-neutral2 spu-color-neutral9 js-endpointRef-exampleBar">
      <nav class="s-buttonList js-endpointRef-menu"></nav>

      <div class="endpointRef-exampleRequest spu-padTop-20 js-endpointRef-exampleRequest"></div>
      <div class="endpointRef-exampleResponse spu-padTop-20 js-endpointRef-exampleResponse"></div>
    </s-read-md>
  
  </div>
</div>
</div>

<div class="so-back spu-borderTop-1 spu-borderColor-neutral7 spu-padTB-15">
  <div class="so-chunk">
    <div class="siteFooter">
      <div class="siteFooter__list">
        <a class="siteFooter__list__item" href="https://www.payshares.org/"><span class="graphic-backArrow-9"></span>&#xA0;&#xA0;Payshares.org</a>
        <span class="siteFooter__list__sep">|</span>
        <a class="siteFooter__list__item" href="https://www.payshares.org/bug-bounty-program/">Bug Bounty</a>
        <a class="siteFooter__list__item" href="/payshares-core/software/admin.html">Run a node</a>
        <a class="siteFooter__list__item" href="/guides/things-to-build.html">Build an app</a>
        <a class="siteFooter__list__item" href="https://github.com/payshares/">GitHub</a>
        <a class="siteFooter__list__item" href="http://slack.payshares.org/">Community chat</a>
      </div>
      <div class="siteFooter__list siteFooter__list--aux">
        <a class="siteFooter__list__item siteFooter__list__item--aux" href="https://www.payshares.org/terms-of-service/">Terms of service</a>
        <a class="siteFooter__list__item siteFooter__list__item--aux" href="https://www.payshares.org/privacy-policy/">Privacy policy</a>
      </div>
    </div>
  </div>
</div>
</body>
<script src="/js/app-29e9eab4c89c33d7fb1e0705ca62d0cc.js"></script>
<script type="text/javascript">
!function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
analytics.load("U8cLXTFMPm");
analytics.page()
}}();
</script>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5V3WNNP');</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5V3WNNP" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
</html>
