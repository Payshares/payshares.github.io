<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!--

  Want to contribute to this site? Take a look at the GitHub repository for this
  site: https://github.com/payshares/developers

  -->
  <title>Architecture | Payshares Developers</title>
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->
  <meta name="author" content="Payshares.org and contributors">

  <meta property="og:title" content="Architecture | Payshares Developers">
  <meta property="og:type" content="website">


  <link rel="stylesheet" href="/styles/index-642cd6cc68250700f4daa5029026a066.css">

  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicon/rocket-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicon/rocket-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/rocket-180x180.png">
  <link rel="icon" type="image/png" href="/images/favicon/rocket-96x96.png" sizes="96x96">
  <meta name="msapplication-TileImage" content="/images/favicon/rocket-144x144.png">

  <script type="text/javascript">
    var $mcGoal = {'settings':{'uuid':'c001d97369b7a10d224c23867','dc':'us9'}};
    (function() {
      var sp = document.createElement('script'); sp.type = 'text/javascript'; sp.async = true; sp.defer = true;
      sp.src = ('https:' == document.location.protocol ? 'https://s3.amazonaws.com/downloads.mailchimp.com' : 'http://downloads.mailchimp.com') + '/js/goal.min.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(sp, s);
    })();
  </script>

  <script>window.clientData = {};</script>

  <script type="text/javascript">
  setTimeout(function(){var a=document.createElement("script");
  var b=document.getElementsByTagName("script")[0];
  a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
  </script>
</head>
<body>
<div class="header2016">
  <div class="header2016__logo header2016__logo--spaced">
    <div class="so-siteHeader">
      <span class="so-logo">
  <a href="https://www.payshares.org/" class="so-logo__main">Payshares</a><!--
  --><span class="so-logo__separator"> </span><!--
  --><a href="/" class="so-logo__subSite">developers</a>
</span>
    </div>
  </div>
  <nav class="header2016__nav mainNavMenu spu-padStart-30">
    <a class="mainNavMenu__item is-currentItem" href="/guides/">Guides</a>
<a class="mainNavMenu__item " href="/reference/">API Reference</a>
<a class="mainNavMenu__item " href="/software/">Software</a>
<a class="mainNavMenu__item " href="/tools/">Tools</a>
  </nav>
</div>

<div class="S-flex-row">
  <div class="siteSidebar pageNavListBounder">
  <div class="mainSidebar">
    <ul class="pageNavList">

      <li class="pageNavList__subList">
        <span class="pageNavList__title">Get Started</span>
        <ol class="collapsibleListSet__list">
                    <li class="pageNavList__item"><a href="/guides/get-started/index.html">Payshares Network Overview</a></li>
          <li class="pageNavList__item"><a href="/guides/get-started/create-account.html">Create an Account</a></li>
  <li class="pageNavList__item"><a href="/guides/get-started/transactions.html">Send and Receive Money</a></li>

        </ol>
      </li>
    


      <li class="pageNavList__subList">
        <span class="pageNavList__title">Become an Anchor</span>
        <ol class="collapsibleListSet__list">
                    <li class="pageNavList__item is-currentItem"><a href="/guides/anchor/index.html">Architecture</a></li>
          <li class="pageNavList__item"><a href="/guides/anchor/2-bridge-server.html">Bridge Server</a></li>
  <li class="pageNavList__item"><a href="/guides/anchor/3-federation-server.html">Federation Server</a></li>
  <li class="pageNavList__item"><a href="/guides/anchor/4-compliance-server.html">Compliance Server</a></li>
  <li class="pageNavList__item"><a href="/guides/anchor/5-conclusion.html">Next Steps</a></li>

        </ol>
      </li>
    
      
      <li class="pageNavList__subList">
        <span class="pageNavList__title">Concepts</span>
        <ul class="collapsibleListSet__list">
              <li class="pageNavList__item"><a href="/guides/concepts/accounts.html">Accounts</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/assets.html">Assets</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/exchange.html">Distributed Exchange</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/federation.html">Federation</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/fees.html">Fees</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/inflation.html">Inflation</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/ledger.html">Ledger</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/list-of-operations.html">List of Operations</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/multi-sig.html">Multisignature</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/operations.html">Operations</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/scp.html">Payshares Consensus Protocol</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/stellar-toml.html">Payshares.toml</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/test-net.html">Testnet</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/transactions.html">Transactions</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/versioning.html">Versioning and Upgrading</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/xdr.html">XDR</a></li>

        </ul>
      </li>
    
        <li class="pageNavList__item"><a href="/guides/attachment.html">Payshares Attachment Convention</a></li>
  <li class="pageNavList__item"><a href="/guides/channels.html">Channels</a></li>
  <li class="pageNavList__item"><a href="/guides/compliance-protocol.html">Compliance Protocol</a></li>
  <li class="pageNavList__item"><a href="/guides/issuing-assets.html">Issuing Assets</a></li>
  <li class="pageNavList__item"><a href="/guides/security.html">Security</a></li>
  <li class="pageNavList__item"><a href="/guides/things-to-build.html">Build Payshares Apps</a></li>
        <li class="pageNavList__item"><a href="/guides/contributing.html">Contribution Guide</a></li>
    </ul>
  </div>
</div>
  <div class="S-flexItem-share">
  <div class="spu-padSE-30">
    <h1 class="mainSectionTitle">
      Architecture
      
    </h1>
  </div>
  <div class="S-flex-rowWrap spu-borderTop-1 spu-borderColor-neutral7">
    <s-read-md class="S-flexItem-share mainContent s-read-md--capped spu-padSE-30 spu-padTB-20 documentRead" link-process-md>
      <p>Anchors are entities that people trust to hold their deposits and <a href="../issuing-assets.html">issue credits</a> into the Payshares network for those deposits. All money transactions in the Payshares network (except stakks) occur in the form of credit issued by anchors, so anchors act as a bridge between existing currencies and the Payshares network. Most anchors are organizations like banks, savings institutions, farmers&#x2019; co-ops, central banks, and remittance companies.</p>
<p>Before continuing, you should be familiar with:</p>
<ul>
<li><a href="../issuing-assets.html">Issuing assets</a>, the most basic activity of an anchor.</li>
<li><a href="../concepts/federation.html">Federation</a>, which allows a single Payshares account to represent multiple people.</li>
<li><a href="../compliance-protocol.html">Compliance</a>, if you are subject to any financial regulation.</li>
</ul>
<h2 id="account-structure"><a class="anchorShortcut" href="#account-structure" aria-hidden="true"></a> Account Structure</h2>
<p>As an anchor, you should maintain at least two accounts:</p>
<ul>
<li>An <strong>issuing account</strong> used only for issuing and destroying assets.</li>
<li>A <strong>base account</strong> used to transact with other Payshares accounts. It holds a balance of assets issued by the <em>issuing account</em>.</li>
</ul>
<p>Create them on the test network using the <a href="https://payshares.org/laboratory/">laboratory</a> or the steps from the <a href="../get-started/create-account.html">&#x201C;get started&#x201D; guide</a>.</p>
<p>For this guide, we&#x2019;ll use the following keys:</p>
<dl>
  <dt>Issuing Account ID</dt>
  <dd><code>GAIUIQNMSXTTR4TGZETSQCGBTIF32G2L5P4AML4LFTMTHKM44UHIN6XQ</code></dd>
  <dt>Issuing Seed</dt>
  <dd><code>SBILUHQVXKTLPYXHHBL4IQ7ISJ3AKDTI2ZC56VQ6C2BDMNF463EON65U</code></dd>
  <dt>Base Account ID</dt>
  <dd><code>GAIGZHHWK3REZQPLQX5DNUN4A32CSEONTU6CMDBO7GDWLPSXZDSYA4BU</code></dd>
  <dt>Base Seed</dt>
  <dd><code>SAV75E2NK7Q5JZZLBBBNUPCIAKABN64HNHMDLD62SZWM6EBJ4R7CUNTZ</code></dd>
</dl>
<h3 id="customer-accounts"><a class="anchorShortcut" href="#customer-accounts" aria-hidden="true"></a> Customer Accounts</h3>
<p>There are two simple ways to account for your customers&#x2019; funds:</p>
<ol>
<li>
<p>Maintain a Payshares account for each customer. When a customer deposits money with your institution, you should pay an equivalent amount of your custom asset into the customer&#x2019;s Payshares account from your <em>base account</em>. When a customer needs to obtain physical currency from you, deduct the equivalent amount of your custom asset from their Payshares account.</p>
<p>This approach simplifies bookkeeping by utilizing the Payshares network instead of your own internal systems. It can also allow your customers a little bit more control over how their account works in Payshares.</p>
</li>
<li>
<p>Use <a href="../concepts/federation.html">federation</a> and the <a href="../concepts/transactions.html#memo"><code>memo</code></a> field in transactions to send and receive payments on behalf of your customers. In this approach, transactions intended for your customers are all made using your <em>base account</em>. The <code>memo</code> field of the transaction is used to identify the actual customer a payment is intended for.</p>
<p>Using a single account requires you to do additional bookkeeping, but means you have fewer keys to manage and more control over accounts. If you already have existing banking systems, this is the simplest way to integrate Payshares with them.</p>
</li>
</ol>
<p>You can also create your own variations on the above approaches. <strong>For this guide, we&#x2019;ll follow approach #2&#x2014;using a single Payshares account to transact on behalf of your customers.</strong></p>
<h2 id="data-flow"><a class="anchorShortcut" href="#data-flow" aria-hidden="true"></a> Data Flow</h2>
<p>In order to act as an anchor, your infrastructure will need to:</p>
<ul>
<li>Make payments.</li>
<li>Monitor a Payshares account and update customer accounts when payments are received.</li>
<li>Look up and respond to requests for federated addresses.</li>
<li>Comply with Anti-Money Laundering (AML) regulations.</li>
</ul>
<p>Payshares provides a prebuilt <a href="https://github.com/payshares/go/tree/master/services/federation">federation server</a> and <a href="https://github.com/payshares/bridge-server/blob/master/readme_compliance.md">regulatory compliance server</a> designed for you to install and integrate with your existing infrastructure. The <a href="https://github.com/payshares/bridge-server/blob/master/readme_bridge.md">bridge server</a> coordinates them and simplifies interacting with the Payshares network. This guide demonstrates how to integrate them with your infrastructure, but you can also write your own customized versions.</p>
<h3 id="making-payments"><a class="anchorShortcut" href="#making-payments" aria-hidden="true"></a> Making Payments</h3>
<p>When using the above services, a complex payment using federation and compliance works as follows:</p>
<figure><img src="assets/anchor-send-payment-compliance.png" alt="Diagram of sending a payment"></figure>
<ol>
<li>A customer using your organization&#x2019;s app or web site sends a payment using your services.</li>
<li>Your internal services send a payment using the bridge server.</li>
<li>The bridge server determines whether compliance checks are needed and forwards transaction information to the compliance server.</li>
<li>The compliance server determines the receiving account ID by looking up the federation address.</li>
<li>The compliance server contacts your internal services to get information about the customer sending the payment in order to provide it to the receiving organization&#x2019;s compliance systems.</li>
<li>If the result is successful, the bridge server creates a transaction, signs it, and sends it to the Payshares network.</li>
<li>Once the transaction is confirmed on the network, the bridge server returns the result to your services, which should update your customer&#x2019;s account.</li>
</ol>
<h3 id="receiving-payments"><a class="anchorShortcut" href="#receiving-payments" aria-hidden="true"></a> Receiving Payments:</h3>
<p>When someone is sending a transaction to you, the flow is slightly different:</p>
<figure><img src="assets/anchor-receive-payment-compliance.png" alt="Diagram of receiving a payment"></figure>
<ol>
<li>The sender looks up the Payshares account ID to send the payment to based on your customer&#x2019;s federated address from your federation server.</li>
<li>The sender contacts your compliance server with information about the person sending the payment.</li>
<li>Your compliance server contacts three services you implement:
<ol>
<li>A sanctions callback to determine whether the sender is permitted to pay your customer.</li>
<li>If the sender wants to check your customer&#x2019;s information, a callback is used to determine whether you are willing to share your customer&#x2019;s information.</li>
<li>The same callback used when sending a payment (above) is used to actually get your customer&#x2019;s information.</li>
</ol>
</li>
<li>The sender submits the transaction to the Payshares network.</li>
<li>The bridge server monitors the Payshares network for the transaction and sends it to your compliance server to verify that it was the same transaction you approved in step 3.1.</li>
<li>The bridge server contacts a service you implement to notify you about the transaction. You can use this step to update your customer&#x2019;s account balances.</li>
</ol>
<p><strong>While these steps can seem complicated, Payshares&#x2019;s bridge, federation, and compliance services do most of the work.</strong> You only need to implement four callbacks and create a <a href="../concepts/payshares-toml.html">payshares.toml</a> file where others can find the URL of your services.</p>
<p>In the rest of this guide, we&#x2019;ll walk through setting up each part of this infrastructure step by step.</p>
<nav class="sequence-navigation">
  <a rel="next" href="2-bridge-server.html" class="button button--next">Next: Bridge Server</a>
</nav>

      <br>
      <a href="https://github.com/payshares/docs/blob/master/guides/anchor/readme.md" class="spu-color-neutral6">Edit this doc in GitHub</a>
    </s-read-md>
  
  </div>
</div>
</div>

<div class="so-back spu-borderTop-1 spu-borderColor-neutral7 spu-padTB-15">
  <div class="so-chunk">
    <div class="siteFooter">
      <div class="siteFooter__list">
        <a class="siteFooter__list__item" href="https://www.payshares.org/"><span class="graphic-backArrow-9"></span>&#xA0;&#xA0;Payshares.org</a>
        <span class="siteFooter__list__sep">|</span>
        <a class="siteFooter__list__item" href="https://www.payshares.org/bug-bounty-program/">Bug Bounty</a>
        <a class="siteFooter__list__item" href="/payshares-core/software/admin.html">Run a node</a>
        <a class="siteFooter__list__item" href="/guides/things-to-build.html">Build an app</a>
        <a class="siteFooter__list__item" href="https://github.com/payshares/">GitHub</a>
        <a class="siteFooter__list__item" href="http://slack.payshares.org/">Community chat</a>
      </div>
      <div class="siteFooter__list siteFooter__list--aux">
        <a class="siteFooter__list__item siteFooter__list__item--aux" href="https://www.payshares.org/terms-of-service/">Terms of service</a>
        <a class="siteFooter__list__item siteFooter__list__item--aux" href="https://www.payshares.org/privacy-policy/">Privacy policy</a>
      </div>
    </div>
  </div>
</div>
</body>
<script src="/js/app-29e9eab4c89c33d7fb1e0705ca62d0cc.js"></script>
<script type="text/javascript">
!function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
analytics.load("U8cLXTFMPm");
analytics.page()
}}();
</script>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5V3WNNP');</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5V3WNNP" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
</html>
