<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!--

  Want to contribute to this site? Take a look at the GitHub repository for this
  site: https://github.com/payshares/developers

  -->
  <title>Federation Server | Payshares Developers</title>
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->
  <meta name="author" content="Payshares.org and contributors">

  <meta property="og:title" content="Federation Server | Payshares Developers">
  <meta property="og:type" content="website">


  <link rel="stylesheet" href="/styles/index-642cd6cc68250700f4daa5029026a066.css">

  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicon/rocket-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicon/rocket-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/rocket-180x180.png">
  <link rel="icon" type="image/png" href="/images/favicon/rocket-96x96.png" sizes="96x96">
  <meta name="msapplication-TileImage" content="/images/favicon/rocket-144x144.png">

  <script type="text/javascript">
    var $mcGoal = {'settings':{'uuid':'c001d97369b7a10d224c23867','dc':'us9'}};
    (function() {
      var sp = document.createElement('script'); sp.type = 'text/javascript'; sp.async = true; sp.defer = true;
      sp.src = ('https:' == document.location.protocol ? 'https://s3.amazonaws.com/downloads.mailchimp.com' : 'http://downloads.mailchimp.com') + '/js/goal.min.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(sp, s);
    })();
  </script>

  <script>window.clientData = {};</script>

  <script type="text/javascript">
  setTimeout(function(){var a=document.createElement("script");
  var b=document.getElementsByTagName("script")[0];
  a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
  </script>
</head>
<body>
<div class="header2016">
  <div class="header2016__logo header2016__logo--spaced">
    <div class="so-siteHeader">
      <span class="so-logo">
  <a href="https://www.payshares.org/" class="so-logo__main">Payshares</a><!--
  --><span class="so-logo__separator"> </span><!--
  --><a href="/" class="so-logo__subSite">developers</a>
</span>
    </div>
  </div>
  <nav class="header2016__nav mainNavMenu spu-padStart-30">
    <a class="mainNavMenu__item is-currentItem" href="/guides/">Guides</a>
<a class="mainNavMenu__item " href="/reference/">API Reference</a>
<a class="mainNavMenu__item " href="/software/">Software</a>
<a class="mainNavMenu__item " href="/tools/">Tools</a>
  </nav>
</div>

<div class="S-flex-row">
  <div class="siteSidebar pageNavListBounder">
  <div class="mainSidebar">
    <ul class="pageNavList">

      <li class="pageNavList__subList">
        <span class="pageNavList__title">Get Started</span>
        <ol class="collapsibleListSet__list">
                    <li class="pageNavList__item"><a href="/guides/get-started/index.html">Payshares Network Overview</a></li>
          <li class="pageNavList__item"><a href="/guides/get-started/create-account.html">Create an Account</a></li>
  <li class="pageNavList__item"><a href="/guides/get-started/transactions.html">Send and Receive Money</a></li>

        </ol>
      </li>
    


      <li class="pageNavList__subList">
        <span class="pageNavList__title">Become an Anchor</span>
        <ol class="collapsibleListSet__list">
                    <li class="pageNavList__item"><a href="/guides/anchor/index.html">Architecture</a></li>
          <li class="pageNavList__item"><a href="/guides/anchor/2-bridge-server.html">Bridge Server</a></li>
  <li class="pageNavList__item is-currentItem"><a href="/guides/anchor/3-federation-server.html">Federation Server</a></li>
  <li class="pageNavList__item"><a href="/guides/anchor/4-compliance-server.html">Compliance Server</a></li>
  <li class="pageNavList__item"><a href="/guides/anchor/5-conclusion.html">Next Steps</a></li>

        </ol>
      </li>
    
      
      <li class="pageNavList__subList">
        <span class="pageNavList__title">Concepts</span>
        <ul class="collapsibleListSet__list">
              <li class="pageNavList__item"><a href="/guides/concepts/accounts.html">Accounts</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/assets.html">Assets</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/exchange.html">Distributed Exchange</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/federation.html">Federation</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/fees.html">Fees</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/inflation.html">Inflation</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/ledger.html">Ledger</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/list-of-operations.html">List of Operations</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/multi-sig.html">Multisignature</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/operations.html">Operations</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/scp.html">Payshares Consensus Protocol</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/stellar-toml.html">Payshares.toml</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/test-net.html">Testnet</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/transactions.html">Transactions</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/versioning.html">Versioning and Upgrading</a></li>
  <li class="pageNavList__item"><a href="/guides/concepts/xdr.html">XDR</a></li>

        </ul>
      </li>
    
        <li class="pageNavList__item"><a href="/guides/attachment.html">Payshares Attachment Convention</a></li>
  <li class="pageNavList__item"><a href="/guides/channels.html">Channels</a></li>
  <li class="pageNavList__item"><a href="/guides/compliance-protocol.html">Compliance Protocol</a></li>
  <li class="pageNavList__item"><a href="/guides/issuing-assets.html">Issuing Assets</a></li>
  <li class="pageNavList__item"><a href="/guides/security.html">Security</a></li>
  <li class="pageNavList__item"><a href="/guides/things-to-build.html">Build Payshares Apps</a></li>
        <li class="pageNavList__item"><a href="/guides/contributing.html">Contribution Guide</a></li>
    </ul>
  </div>
</div>
  <div class="S-flexItem-share">
  <div class="spu-padSE-30">
    <h1 class="mainSectionTitle">
      Federation Server
      
    </h1>
  </div>
  <div class="S-flex-rowWrap spu-borderTop-1 spu-borderColor-neutral7">
    <s-read-md class="S-flexItem-share mainContent s-read-md--capped spu-padSE-30 spu-padTB-20 documentRead" link-process-md>
      <p>When testing the bridge server, we added a <code>memo</code> to the transaction in order to identify what customer account to credit. However, other people and organizations using Payshares might not know they need to do that. How do they find out?</p>
<p>The <a href="../concepts/federation.html">Payshares federation protocol</a> allows you to convert a human-readable address like <code>amy*your_org.com</code><sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> to an account ID. It also includes information about what should be in a transaction&#x2019;s <code>memo</code>. When sending a payment, you contact a federation server first to determine what Payshares account ID to pay. Luckily, the bridge server does this for you.</p>
<figure><img src="assets/anchor-send-payment-federation.png" alt="Payment flow diagram"></figure>
<p><a href="http://Payshares.org">Payshares.org</a> provides a <a href="https://github.com/payshares/go/tree/master/services/federation">prebuilt federation server</a> that can hook into an existing user database, but you can also write your own.</p>
<h2 id="create-a-database"><a class="anchorShortcut" href="#create-a-database" aria-hidden="true"></a> Create a Database</h2>
<p>The Payshares federation server is designed to connect to any existing SQL database you might have with a list of account names. It essentially translates a federation request into a SQL query. The server supports MySQL, PostgreSQL, and SQLite3.</p>
<p>At a minimum, your database should have a table with a column identifying the name to use for each account record.<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup> In your existing system, you might have a table named <code>accounts</code> that looks something like:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>first_name</th>
<th>last_name</th>
<th>friendly_id</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Tunde</td>
<td>Adebayo</td>
<td>tunde_adebayo</td>
</tr>
<tr>
<td>2</td>
<td>Amy</td>
<td>Smith</td>
<td>amy_smith</td>
</tr>
<tr>
<td>3</td>
<td>Jack</td>
<td>Brown</td>
<td>jack_brown</td>
</tr>
<tr>
<td>4</td>
<td>Steint&#xF3;r</td>
<td>J&#xE1;kupsson</td>
<td>steintor_jakupsson</td>
</tr>
<tr>
<td>5</td>
<td>Sneha</td>
<td>Kapoor</td>
<td>sneha_kapoor</td>
</tr>
</tbody>
</table>
<p>Where Tunde&#x2019;s Payshares address would be <code>tunde_adebayo*your_org.com</code>.</p>
<h2 id="download-and-configure-federation-server"><a class="anchorShortcut" href="#download-and-configure-federation-server" aria-hidden="true"></a> Download and Configure Federation Server</h2>
<p>Next, <a href="https://github.com/payshares/go/releases">download the latest federation server</a> for your platform. Install the executable anywhere you like. In the same directory, create a file named <code>federation.cfg</code>. This will store the configuration for the server. It should look something like:</p>
<code-example name="federation.cfg">
<pre><code class="language-toml">port = 8002

[database]
type = &quot;mysql&quot; # Or &quot;postgres&quot; or &quot;sqlite3&quot;
dsn = &quot;dbuser:dbpassword@/internal_accounts&quot;

[queries]
federation = &quot;SELECT &apos;GAIGZHHWK3REZQPLQX5DNUN4A32CSEONTU6CMDBO7GDWLPSXZDSYA4BU&apos; as id, friendly_id as memo, &apos;text&apos; as memo_type FROM accounts WHERE friendly_id = ? AND ? = &apos;your_org.com&apos;&quot;
reverse-federation = &quot;SELECT friendly_id, &apos;&apos; as domain FROM accounts WHERE ? = &apos;&apos;&quot;

# The federation server must be available via HTTPS. Specify your SSL
# certificate and key here. If the server is behind a proxy or load balancer
# that implements HTTPS, you can omit this section.
[tls]
certificate-file = &quot;server.crt&quot;
private-key-file = &quot;server.key&quot;
</code></pre>
</code-example>
<p>Make sure to update the database connection information with the proper credentials and name for your database. Also update the value of <code>domain</code> in the <code>federation</code> query to match your actual domain instead of <code>your_org.com</code>.</p>
<p>The <code>federation</code> query is a SQL query that should return the columns <code>id</code>, <code>memo</code>, and <code>memo_type</code> when supplied with the two parts of a Payshares address, e.g. <code>tunde_adeboyo</code> and <code>your_org.com</code> for the address <code>tunde_adebayo*your_org.com</code>.</p>
<p>Since we are mapping all addresses to our base account, we always return the base account ID for <code>id</code>. As in the first section, we want the account&#x2019;s <code>friendly_id</code> as a text memo.</p>
<p>The <code>reverse-federation</code> query is required, but because all customer accounts map to a single Payshares account in our design, we need to make sure this query always returns no rows.</p>
<p>Now run the server! (Unlike the bridge server, there&#x2019;s there no custom database to migrate.)</p>
<pre><code class="language-bash">./federation
</code></pre>
<h2 id="update-paysharestoml"><a class="anchorShortcut" href="#update-paysharestoml" aria-hidden="true"></a> Update Payshares.toml</h2>
<p>Finally, others have to know the URL of your federation server. The <a href="../concepts/payshares-toml.html"><code>payshares.toml</code> file</a> is publicly available file where others can find information about your Payshares integration. It should always be stored at:</p>
<p><code>https://[YOUR DOMAIN]/.well-known/payshares.toml</code></p>
<p>It can list all sorts of properties, but the one we care about now is the URL for your federation server. Your <code>payshares.toml</code> file should look something like:</p>
<code-example name="payshares.toml">
<pre><code class="language-toml">FEDERATION_SERVER = &quot;https://www.your_org.com:8002/federation&quot;
</code></pre>
</code-example>
<p>The actual URL for your federation server can be anything you like&#x2014;it can be at your <code>www</code> subdomain but on a different path, it can be at a different port, or it can be on a different domain entirely. <strong>However, it must be available via HTTPS with a valid SSL certificate.</strong><sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup></p>
<h2 id="send-a-federation-request"><a class="anchorShortcut" href="#send-a-federation-request" aria-hidden="true"></a> Send a Federation request</h2>
<p>Test out your federation server by sending an HTTP request:</p>
<code-example name="Request a Federation Info">
<pre><code class="language-bash">curl &quot;https://www.your_org.com:8002/federation?q=tunde_adebayo*your_org.com&amp;type=name&quot;
</code></pre>
<pre><code class="language-js">var request = require(&apos;request&apos;);

request.get({
  url: &apos;https://www.your_org.com:8002/federation&apos;,
  qs: {
    q: &apos;tunde_adebayo*your_org.com&apos;,
    type: &apos;name&apos;
  }
}, function(error, response, body) {
  console.log(body);
});
</code></pre>
<pre><code class="language-java">import org.apache.http.HttpEntity;
import org.apache.http.HttpResponse;
import org.apache.http.client.HttpClient;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.impl.client.HttpClients;
import org.apache.http.util.EntityUtils;
import org.apache.http.client.utils.URIBuilder;
import java.net.URI;

class FederationRequest {
  public static void main(String [] args) throws Exception {
    URI federationUri = new URIBuilder(&quot;https://www.your_org.com:8002/federation&quot;)
      .addParameter(&quot;q&quot;, &quot;tunde_adebayo*your_org.com&quot;)
      .addParameter(&quot;type&quot;, &quot;name&quot;)
      .build();

    HttpGet federationRequest = new HttpGet(federationUri);
    HttpClient httpClient = HttpClients.createDefault();
    HttpResponse response = httpClient.execute(federationRequest);
    HttpEntity entity = response.getEntity();
    if (entity != null) {
      String body =  EntityUtils.toString(entity);
      System.out.println(body);
    }
  }
}
</code></pre>
</code-example>
<p>You should get a response like:</p>
<pre><code class="language-json">{
  &quot;payshares_address&quot;: &quot;tunde_adebayo*your_org.com&quot;,
  &quot;account_id&quot;: &quot;GAIGZHHWK3REZQPLQX5DNUN4A32CSEONTU6CMDBO7GDWLPSXZDSYA4BU&quot;,
  &quot;memo_type&quot;: &quot;text&quot;,
  &quot;memo&quot;: &quot;tunde_adebayo&quot;
}
</code></pre>
<nav class="sequence-navigation">
  <a rel="prev" href="2-bridge-server.html" class="button button--previous">Back: Bridge Server</a>
  <a rel="next" href="4-compliance-server.html" class="button button--next">Next: Compliance Server</a>
</nav>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>Federated addresses use an <code>*</code> to separate the username and domain so that your usernames can be e-mail addresses, like <code>amy@gmail.com*your_org.com</code>. <a href="#fnref1" class="footnote-backref">&#x21A9;&#xFE0E;</a></p>
</li>
<li id="fn2" class="footnote-item"><p>If you want your federation server to cover multiple domains, you&#x2019;ll need a column to store the domains as well. <a href="#fnref2" class="footnote-backref">&#x21A9;&#xFE0E;</a></p>
</li>
<li id="fn3" class="footnote-item"><p>Requiring that public services are available via SSL helps keep things secure. While testing, you can get free certificates from <a href="http://letsencrypt.org">http://letsencrypt.org</a>. You can also generate your own self-signed certificates, but you must add them to all the computers in your tests. <a href="#fnref3" class="footnote-backref">&#x21A9;&#xFE0E;</a></p>
</li>
</ol>
</section>

      <br>
      <a href="https://github.com/payshares/docs/blob/master/guides/anchor/3-federation-server.md" class="spu-color-neutral6">Edit this doc in GitHub</a>
    </s-read-md>
  
  </div>
</div>
</div>

<div class="so-back spu-borderTop-1 spu-borderColor-neutral7 spu-padTB-15">
  <div class="so-chunk">
    <div class="siteFooter">
      <div class="siteFooter__list">
        <a class="siteFooter__list__item" href="https://www.payshares.org/"><span class="graphic-backArrow-9"></span>&#xA0;&#xA0;Payshares.org</a>
        <span class="siteFooter__list__sep">|</span>
        <a class="siteFooter__list__item" href="https://www.payshares.org/bug-bounty-program/">Bug Bounty</a>
        <a class="siteFooter__list__item" href="/payshares-core/software/admin.html">Run a node</a>
        <a class="siteFooter__list__item" href="/guides/things-to-build.html">Build an app</a>
        <a class="siteFooter__list__item" href="https://github.com/payshares/">GitHub</a>
        <a class="siteFooter__list__item" href="http://slack.payshares.org/">Community chat</a>
      </div>
      <div class="siteFooter__list siteFooter__list--aux">
        <a class="siteFooter__list__item siteFooter__list__item--aux" href="https://www.payshares.org/terms-of-service/">Terms of service</a>
        <a class="siteFooter__list__item siteFooter__list__item--aux" href="https://www.payshares.org/privacy-policy/">Privacy policy</a>
      </div>
    </div>
  </div>
</div>
</body>
<script src="/js/app-29e9eab4c89c33d7fb1e0705ca62d0cc.js"></script>
<script type="text/javascript">
!function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
analytics.load("U8cLXTFMPm");
analytics.page()
}}();
</script>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5V3WNNP');</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5V3WNNP" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
</html>
